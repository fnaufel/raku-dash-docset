<!doctype html>
<html lang="en">
<head>
    <title>Metaobject protocol (MOP)</title>
    <meta charset="UTF-8"/>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="../css/app.css" media="screen" title="default" />
    <noscript> <style> #search { visibility: hidden; } </style> </noscript>
</head>

<body class="pod">

    <div id="___top"></div>

    <div id="header" class="pretty-box green">

        <a href="../index.html">
            <img src="../images/Camelia.svg" alt="»ö«" id="logo" width="62" height="48"/> &nbsp;Raku Documentation
        </a>

        <div id="search" class="ui-widget">
            <div class="green">
                <input placeholder="Loading..." id="query" accesskey="f" title="Enter term to search for (hit Esc to focus)"/>
            </div>
            <p id="not-found-message">
                Not in Index (<a href="mop.html" id="try-web-search">try site search</a>)
            </p>
        </div>

        <div class="menu">

            <div class="menu-items dark-green">
                <a class='menu-item darker-green' href='https://raku.org'><strong>Raku homepage</strong></a>
                    <a class="menu-item selected darker-green" href="../language.html"> Language </a>
                    <a class="menu-item " href="../type.html"> Types </a>
                    <a class="menu-item " href="../routine.html"> Routines </a>
                    <a class="menu-item " href="../programs.html"> Programs </a>
                    <a class="menu-item " href="https://web.libera.chat/?channel=#raku"> Chat with us </a>
            </div>

            
            

        </div>
    </div>

    <div id="content" class="pretty-box yellow content_fragment">

        <div align="right" style="display:;">
            <button title="Edit this page"  class="pencil" onclick="location='https://github.com/Raku/doc/edit/master/doc//Language/mop.pod6'">
                <svg width="14px" height="16px" viewBox="0 0 14 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <defs></defs>
                    <g id="Octicons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g id="pencil" fill="#000000">
                            <path d="M0,12 L0,15 L3,15 L11,7 L8,4 L0,12 L0,12 Z M3,14 L1,14 L1,12 L2,12 L2,13 L3,13 L3,14 L3,14 Z M13.3,4.7 L12,6 L9,3 L10.3,1.7 C10.69,1.31 11.32,1.31 11.71,1.7 L13.3,3.29 C13.69,3.68 13.69,4.31 13.3,4.7 L13.3,4.7 Z" id="Shape"></path>
                        </g>
                    </g>
                </svg>
            </button>
        </div>

        <h1 class="title">Metaobject protocol (MOP)</h1>
        <p class="subtitle">Introspection and the Raku object system</p>

        <nav class="indexgroup">
<table id="TOC">
<caption><h2 id="TOC_Title">Table of Contents</h2></caption>
<tr class="toc-level-1"><td class="toc-number">1</td><td class="toc-text"><a href="mop.html#Metamethods">Metamethods</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">1.1</td><td class="toc-text"><a href="mop.html#WHAT">WHAT</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">1.2</td><td class="toc-text"><a href="mop.html#WHICH">WHICH</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">1.3</td><td class="toc-text"><a href="mop.html#WHO">WHO</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">1.4</td><td class="toc-text"><a href="mop.html#WHERE">WHERE</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">1.5</td><td class="toc-text"><a href="mop.html#HOW">HOW</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">1.6</td><td class="toc-text"><a href="mop.html#WHY">WHY</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">1.7</td><td class="toc-text"><a href="mop.html#DEFINITE">DEFINITE</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">1.8</td><td class="toc-text"><a href="mop.html#VAR">VAR</a></td></tr>
<tr class="toc-level-1"><td class="toc-number">2</td><td class="toc-text"><a href="mop.html#Metaclass_methods">Metaclass methods</a></td></tr>
<tr class="toc-level-1"><td class="toc-number">3</td><td class="toc-text"><a href="mop.html#Structure_of_the_metaobject_system">Structure of the metaobject system</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">3.1</td><td class="toc-text"><a href="mop.html#Bootstrapping_concerns">Bootstrapping concerns</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">3.2</td><td class="toc-text"><a href="mop.html#Composition_time_and_static_reasoning">Composition time and static reasoning</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">3.3</td><td class="toc-text"><a href="mop.html#Power_and_responsibility">Power and responsibility</a></td></tr>
<tr class="toc-level-2"><td class="toc-number">3.4</td><td class="toc-text"><a href="mop.html#Power,_convenience_and_pitfalls">Power, convenience and pitfalls</a></td></tr>

</table>
</nav>

        <div class="pod-body ">
            <p><a name="index-entry-MOP"></a> <a name="index-entry-Introspection"></a></p>
<p>Raku is built on a metaobject layer. That means that there are objects (the <em>metaobjects</em>) that control how various object-oriented constructs (such as classes, roles, methods, attributes or enums) behave.</p>
<p>The metaobject has a practical benefit to the user when a normal object&#39;s type is needed. For example:</p>
<pre class="editor editor-colors"><div class="line"><span class="source raku"><span class="storage modifier declarator raku"><span>my</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>arr</span></span></span><span>&nbsp;</span><span class="storage modifier assignment raku"><span>=</span></span><span>&nbsp;[</span><span class="constant numeric raku"><span>1</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>2</span></span><span>];</span></span></div><div class="line"><span class="source raku"><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>arr</span></span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="support function raku"><span>name</span></span><span>;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«Array␤»</span><span>&nbsp;</span></span></span></div></pre><p>To get a more in-depth understanding of the metaobject for a <code>class</code>, here is an example repeated twice: once as normal declarations in Raku, and once expressed through the <a href="../type/Metamodel::ClassHOW.html">metamodel</a>:</p>
<pre class="editor editor-colors"><div class="line"><span class="source raku"><span class="meta class raku"><span class="storage type class raku"><span>class</span></span><span>&nbsp;</span><span class="entity name type class raku"><span>A</span></span></span><span>&nbsp;</span><span class="meta block raku"><span class="punctuation definition block raku"><span>{</span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type declarator type raku"><span>method</span></span><span>&nbsp;</span><span class="entity name function raku"><span>x</span></span><span>()&nbsp;</span><span class="meta block raku"><span class="punctuation definition block raku"><span>{</span></span><span>&nbsp;</span><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="constant numeric raku"><span>42</span></span><span>&nbsp;</span><span class="punctuation definition block raku"><span>}</span></span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span class="punctuation definition block raku"><span>}</span></span></span></span></div><div class="line"><span class="source raku"><span>&nbsp;</span></span></div><div class="line"><span class="source raku"><span class="routine name raku"><span>A</span></span><span class="keyword operator generic raku"><span>.</span></span><span class="keyword operator word raku"><span>x</span></span><span>();</span></span></div></pre><p>corresponds to:</p>
<pre class="editor editor-colors"><div class="line"><span class="source raku"><span class="storage modifier declarator raku"><span>constant</span></span><span>&nbsp;</span><span class="routine name raku"><span>A</span></span><span>&nbsp;</span><span class="storage modifier assignment raku"><span>:=</span></span><span>&nbsp;</span><span class="support type raku"><span>Metamodel</span></span><span>::</span><span class="routine name raku"><span>ClassHOW</span></span><span class="keyword operator generic raku"><span>.</span></span><span class="routine name raku"><span>new_type</span></span><span>(&nbsp;</span><span class="string pair key raku"><span>name&nbsp;</span></span><span class="keyword operator multi-symbol raku"><span>=&gt;</span></span><span>&nbsp;</span><span class="string quoted single single raku"><span class="punctuation definition string begin raku"><span>&#39;</span></span><span>A</span><span class="punctuation definition string end raku"><span>&#39;</span></span></span><span>&nbsp;);&nbsp;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;class&nbsp;A&nbsp;{</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source raku"><span class="routine name raku"><span>A</span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="routine name raku"><span>add_method</span></span><span>(</span><span class="string quoted single single raku"><span class="punctuation definition string begin raku"><span>&#39;</span></span><span>x</span><span class="punctuation definition string end raku"><span>&#39;</span></span></span><span>,&nbsp;</span><span class="storage modifier declarator raku"><span>my</span></span><span>&nbsp;</span><span class="storage type declarator type raku"><span>method</span></span><span>&nbsp;</span><span class="entity name function raku"><span>x</span></span><span>(</span><span class="routine name raku"><span>A</span></span><span class="keyword operator generic raku"><span>:</span></span><span>)&nbsp;</span><span class="meta block raku"><span class="punctuation definition block raku"><span>{</span></span><span>&nbsp;</span><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="constant numeric raku"><span>42</span></span><span>&nbsp;</span><span class="punctuation definition block raku"><span>}</span></span></span><span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;&nbsp;&nbsp;method&nbsp;x()</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source raku"><span class="routine name raku"><span>A</span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="routine name raku"><span>compose</span></span><span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;}</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source raku"><span>&nbsp;</span></span></div><div class="line"><span class="source raku"><span class="routine name raku"><span>A</span></span><span class="keyword operator generic raku"><span>.</span></span><span class="keyword operator word raku"><span>x</span></span><span>();</span></span></div></pre><p>(except that the declarative form is executed at compile time, and the latter form does not).</p>
<p>The metaobject behind an object can be obtained with <code>$obj.HOW</code>, where HOW stands for Higher Order Workings (or, <em>HOW the *%@$ does this work?</em>).</p>
<p>Here, the calls with <code>.^</code> are calls to the metaobject, so <code>A.^compose</code> is a shortcut for <code>A.HOW.compose(A)</code>. The invocant is passed in the parameter list as well, to make it possible to support prototype-style type systems, where there is just one metaobject (and not one metaobject per type, as standard Raku does it).</p>
<p>As the example above demonstrates, all object oriented features are available to the user, not just to the compiler. In fact the compiler just uses such calls to metaobjects.</p>
<h1 id="Metamethods"><a class="u" href="mop.html#___top" title="go to top of document">Metamethods</a></h1>
<p>These are introspective macros that resemble method calls.</p>
<p>Metamethods are generally named with ALLCAPS, and it is considered good style to avoid creating your own methods with ALLCAPS names (since they are used conventionally for things like <a href="../syntax/Phasers.html">phasers</a>. This will avoid conflicts with any metamethods that may appear in future versions of the language.</p>
<h2 id="WHAT"><a class="u" href="mop.html#___top" title="go to top of document"><a name="index-entry-syntax_WHAT-WHAT"><span class="index-entry">WHAT</span></a></a></h2>
<p>The type object of the type. This is a pseudo-method that can be overloaded without producing error or warning, but will be ignored.</p>
<p>For example <code>42.WHAT</code> returns the <code>Int</code> type object.</p>
<h2 id="WHICH"><a class="u" href="mop.html#___top" title="go to top of document"><a name="index-entry-syntax_WHICH-WHICH"><span class="index-entry">WHICH</span></a></a></h2>
<p>The object&#39;s identity value. This can be used for hashing and identity comparison, and is how the <code>===</code> infix operator is implemented.</p>
<h2 id="WHO"><a class="u" href="mop.html#___top" title="go to top of document"><a name="index-entry-syntax_WHO-WHO"><span class="index-entry">WHO</span></a></a></h2>
<p>The package supporting the object.</p>
<h2 id="WHERE"><a class="u" href="mop.html#___top" title="go to top of document"><a name="index-entry-syntax_WHERE-WHERE"><span class="index-entry">WHERE</span></a></a></h2>
<p>The memory address of the object. Note that this is not stable in implementations with moving/compacting garbage collectors. Use <code>WHICH</code> for a stable identity indicator.</p>
<h2 id="HOW"><a class="u" href="mop.html#___top" title="go to top of document"><a name="index-entry-syntax_HOW-HOW"><span class="index-entry">HOW</span></a></a></h2>
<p>Returns the metaclass object, as in &quot;Higher Order Workings&quot;.</p>
<pre class="editor editor-colors"><div class="line"><span class="source raku"><span class="support function raku"><span>say</span></span><span>&nbsp;(</span><span class="keyword other special-method raku"><span>%</span></span><span>)</span><span class="keyword operator generic raku"><span>.</span></span><span class="support function raku"><span>HOW</span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="support function raku"><span>name</span></span><span>&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«Perl6::Metamodel::ClassHOW+{&lt;anon&gt;}␤»</span></span></span></div></pre><p><code>HOW</code> returns an object of type <code>Perl6::Metamodel::ClassHOW</code> in this case; objects of this type are used to build classes. The same operation on the <code>&amp;</code> sigil will return <code>Perl6::Metamodel::ParametricRoleGroupHOW</code>. You will be calling this object whenever you use the <code>^</code> syntax to access metamethods. In fact, the code above is equivalent to <code>say (&amp;).HOW.HOW.name(&amp;)</code> which is much more unwieldy. <a href="../type/Metamodel::ClassHOW.html">Metamodel::ClassHOW</a> is part of the Rakudo implementation, so use with caution.</p>
<h2 id="WHY"><a class="u" href="mop.html#___top" title="go to top of document"><a name="index-entry-syntax_WHY-WHY"><span class="index-entry">WHY</span></a></a></h2>
<p>The attached <a href="pod.html">Pod</a> value.</p>
<h2 id="DEFINITE"><a class="u" href="mop.html#___top" title="go to top of document"><a name="index-entry-syntax_DEFINITE-DEFINITE"><span class="index-entry">DEFINITE</span></a></a></h2>
<p>The object has a valid concrete representation. This is a pseudo-method that can be overloaded without producing error or warning, but will be ignored.</p>
<p>Returns <code>True</code> for instances and <code>False</code> for type objects.</p>
<h2 id="VAR"><a class="u" href="mop.html#___top" title="go to top of document"><a name="index-entry-syntax_VAR-VAR"><span class="index-entry">VAR</span></a></a></h2>
<p>Returns the underlying <code>Scalar</code> object, if there is one.</p>
<p><a name="index-entry-is_itemized?"></a> The presence of a <code>Scalar</code> object indicates that the object is &quot;itemized&quot;.</p>
<pre class="editor editor-colors"><div class="line"><span class="source raku"><span class="keyword operator generic raku"><span>.</span></span><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="keyword control repeat raku"><span>for</span></span><span>&nbsp;(</span><span class="constant numeric raku"><span>1</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>2</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>3</span></span><span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«1␤2␤3␤»,&nbsp;not&nbsp;itemized</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source raku"><span class="keyword operator generic raku"><span>.</span></span><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="keyword control repeat raku"><span>for</span></span><span>&nbsp;</span><span class="keyword other special-method raku"><span>$</span></span><span>(</span><span class="constant numeric raku"><span>1</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>2</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>3</span></span><span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«(1&nbsp;2&nbsp;3)␤»,&nbsp;itemized</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source raku"><span class="support function raku"><span>say</span></span><span>&nbsp;(</span><span class="constant numeric raku"><span>1</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>2</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>3</span></span><span>)</span><span class="keyword operator generic raku"><span>.</span></span><span class="support function raku"><span>VAR</span></span><span>&nbsp;</span><span class="keyword operator multi-symbol raku"><span>~~</span></span><span>&nbsp;</span><span class="routine name raku"><span>Scalar</span></span><span>;&nbsp;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«False␤»</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source raku"><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="keyword other special-method raku"><span>$</span></span><span>(</span><span class="constant numeric raku"><span>1</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>2</span></span><span>,&nbsp;</span><span class="constant numeric raku"><span>3</span></span><span>)</span><span class="keyword operator generic raku"><span>.</span></span><span class="support function raku"><span>VAR</span></span><span>&nbsp;</span><span class="keyword operator multi-symbol raku"><span>~~</span></span><span>&nbsp;</span><span class="routine name raku"><span>Scalar</span></span><span>;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«True␤»</span></span></span></div></pre><p>Please refer to the <a href="contexts.html#Item_context">section on item context</a> for more information.</p>
<h1 id="Metaclass_methods"><a class="u" href="mop.html#___top" title="go to top of document">Metaclass methods</a></h1>
<p>Same as you can define object and class methods (which do not have access to the instance variables), you can define metaclass methods, which will work on the metaclass. These are conventionally defined by a caret (<code>^</code>) at the front of the method identifier. These metaclass methods might return a type object or a simple object; in general, they are only conventionally related to the metaobject protocol and are, otherwise, simple methods with a peculiar syntax.</p>
<p>These methods will get called with the type name as first argument, but this needs to be declared explicitly.</p>
<pre class="editor editor-colors"><div class="line"><span class="source raku"><span class="meta class raku"><span class="storage type class raku"><span>class</span></span><span>&nbsp;</span><span class="entity name type class raku"><span>Foo</span></span></span><span>&nbsp;</span><span class="meta block raku"><span class="punctuation definition block raku"><span>{</span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type declarator type raku"><span>method</span></span><span>&nbsp;</span><span>^</span><span class="entity name function raku"><span>bar</span></span><span>(&nbsp;</span><span class="support type raku"><span>Mu</span></span><span>&nbsp;\</span><span class="routine name raku"><span>foo</span></span><span>)&nbsp;</span><span class="meta block raku"><span class="punctuation definition block raku"><span>{</span></span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span class="meta block raku"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="routine name raku"><span>foo</span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="routine name raku"><span>set_name</span></span><span>(&nbsp;</span><span class="routine name raku"><span>foo</span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="support function raku"><span>name</span></span><span>&nbsp;</span><span class="keyword operator generic raku"><span>~</span></span><span>&nbsp;</span><span class="string quoted double raku"><span class="punctuation definition string begin raku"><span>&quot;</span></span><span>[þ]</span><span class="punctuation definition string end raku"><span>&quot;</span></span></span><span>&nbsp;);</span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span class="meta block raku"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition block raku"><span>}</span></span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span class="punctuation definition block raku"><span>}</span></span></span></span></div><div class="line"><span class="source raku"><span class="storage modifier declarator raku"><span>my</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>foo</span></span></span><span>&nbsp;</span><span class="storage modifier assignment raku"><span>=</span></span><span>&nbsp;</span><span class="routine name raku"><span>Foo</span></span><span class="keyword operator generic raku"><span>.</span></span><span class="support function raku"><span>new</span></span><span>();</span></span></div><div class="line"><span class="source raku"><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>foo</span></span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="support function raku"><span>name</span></span><span>;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«Foo␤»</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source raku"><span class="routine name raku"><span>Foo</span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="routine name raku"><span>bar</span></span><span>();</span></span></div><div class="line"><span class="source raku"><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>foo</span></span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="support function raku"><span>name</span></span><span>;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«Foo[þ]␤»</span><span>&nbsp;</span></span></span></div></pre><p>This metaclass method will, via invoking class metamethods, change the name of the class it&#39;s been declared. Since this has been acting on the metaclass, any new object of the same class will receive the same name; invoking <code>say Foo .new().^name</code> will return the same value. As it can be seen, the metaclass method is invoked with no arguments; <code>\foo</code> will, in this case, become the <code>Foo</code> when invoked.</p>
<p>The metaclass methods can receive as many arguments as you want.</p>
<pre class="editor editor-colors"><div class="line"><span class="source raku"><span class="meta class raku"><span class="storage type class raku"><span>class</span></span><span>&nbsp;</span><span class="entity name type class raku"><span>Foo</span></span></span><span>&nbsp;</span><span class="meta block raku"><span class="punctuation definition block raku"><span>{</span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type declarator type raku"><span>method</span></span><span>&nbsp;</span><span>^</span><span class="entity name function raku"><span>bar</span></span><span>(&nbsp;</span><span class="support type raku"><span>Mu</span></span><span>&nbsp;\</span><span class="routine name raku"><span>foo</span></span><span>,&nbsp;</span><span class="support type raku"><span>Str</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>addenda</span></span></span><span>)&nbsp;</span><span class="meta block raku"><span class="punctuation definition block raku"><span>{</span></span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span class="meta block raku"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="routine name raku"><span>foo</span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="routine name raku"><span>set_name</span></span><span>(&nbsp;</span><span class="routine name raku"><span>foo</span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="support function raku"><span>name</span></span><span>&nbsp;</span><span class="keyword operator generic raku"><span>~</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>addenda</span></span></span><span>&nbsp;);</span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span class="meta block raku"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition block raku"><span>}</span></span></span></span></span></div><div class="line"><span class="source raku"><span class="meta block raku"><span class="punctuation definition block raku"><span>}</span></span></span></span></div><div class="line"><span class="source raku"><span class="routine name raku"><span>Foo</span></span><span class="keyword operator generic raku"><span>.</span></span><span class="support function raku"><span>new</span></span><span>()</span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="routine name raku"><span>bar</span></span><span>(&nbsp;&nbsp;</span><span class="string quoted double raku"><span class="punctuation definition string begin raku"><span>&quot;</span></span><span>[baz]</span><span class="punctuation definition string end raku"><span>&quot;</span></span></span><span>&nbsp;);</span></span></div><div class="line"><span class="source raku"><span class="storage modifier declarator raku"><span>my</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>foo</span></span></span><span>&nbsp;</span><span class="storage modifier assignment raku"><span>=</span></span><span>&nbsp;</span><span class="routine name raku"><span>Foo</span></span><span class="keyword operator generic raku"><span>.</span></span><span class="support function raku"><span>new</span></span><span>();</span></span></div><div class="line"><span class="source raku"><span class="support function raku"><span>say</span></span><span>&nbsp;</span><span class="meta variable container raku"><span class="variable other identifier sigil raku"><span>$</span></span><span class="variable other identifier raku"><span>foo</span></span></span><span class="keyword operator generic raku"><span>.</span><span>^</span></span><span class="support function raku"><span>name</span></span><span>;&nbsp;&nbsp;</span><span class="comment line number-sign raku"><span class="punctuation definition comment raku"><span>#</span></span><span>&nbsp;OUTPUT:&nbsp;«Foo[baz]␤»</span><span>&nbsp;</span></span></span></div></pre><p>Again, implicitly, the method call will furnish the first argument, which is the type object. Since they are metaclass methods, you can invoke them on a class (as above) or on an object (as below). The result will be exactly the same.</p>
<h1 id="Structure_of_the_metaobject_system"><a class="u" href="mop.html#___top" title="go to top of document">Structure of the metaobject system</a></h1>
<p><strong>Note:</strong> this documentation largely reflects the metaobject system as implemented by the <a href="https://rakudo.org/">Rakudo Raku compiler</a>, since the <a href="https://design.raku.org/">design documents</a> are very light on details.</p>
<p>For each type declarator keyword, such as <code>class</code>, <code>role</code>, <code>enum</code>, <code>module</code>, <code>package</code>, <code>grammar</code> or <code>subset</code>, there is a separate metaclass in the <code>Metamodel::</code> namespace. (Rakudo implements them in the <code>Perl6::Metamodel::</code> namespace, and then maps <code>Perl6::Metamodel</code> to <code>Metamodel</code>).</p>
<p>Many of these metaclasses share common functionality. For example roles, grammars and classes can all contain methods and attributes, as well as being able to do roles. This shared functionality is implemented in roles which are composed into the appropriate metaclasses. For example <a href="../type/Metamodel::RoleContainer.html">role Metamodel::RoleContainer</a> implements the functionality that a type can hold roles and <a href="../type/Metamodel::ClassHOW.html">Metamodel::ClassHOW</a>, which is the metaclass behind the <code>class</code> keyword, does this role.</p>
<p>Most metaclasses have a <code>compose</code> method that you must call when you&#39;re done creating or modifying a metaobject. It creates method caches, validates things and so on, and weird behavior ensues if you forget to call it, so don&#39;t :-).</p>
<h2 id="Bootstrapping_concerns"><a class="u" href="mop.html#___top" title="go to top of document">Bootstrapping concerns</a></h2>
<p>You might wonder how <code>Metamodel::ClassHOW</code> can be a class, when being a class is defined in terms of <code>Metamodel::ClassHOW</code>, or how the roles responsible for role handling can be roles. The answer is <em>by magic</em>.</p>
<p>Just kidding. Bootstrapping is implementation specific. Rakudo does it by using the object system of the language in which itself is implemented, which happens to be (nearly) a subset of Raku known as <a href="faq.html#What_language_is_NQP_written_in?">NQP</a>. NQP has a primitive, class-like kind called <code>knowhow</code>, which is used to bootstrap its own classes and roles implementation. <code>knowhow</code> is built on primitives that the virtual machine under NQP provides.</p>
<p>Since the object model is bootstrapped in terms of lower-level types, introspection can sometimes return low-level types instead of the ones you expect, like an NQP-level routine instead of a normal <a href="../type/Routine.html">Routine</a> object, or a bootstrap-attribute instead of <a href="../type/Attribute.html">Attribute</a>.</p>
<h2 id="Composition_time_and_static_reasoning"><a class="u" href="mop.html#___top" title="go to top of document">Composition time and static reasoning</a></h2>
<p>In Raku, a type is constructed as it is parsed, so in the beginning, it must be mutable. However if all types were always mutable, all reasoning about them would get invalidated at any modification of a type. For example the list of parent types and thus the result of type checking can change during that time.</p>
<p>So to get the best of both worlds, there is a time when a type transitions from mutable to immutable. This is called <em>composition</em>, and for syntactically declared types, it happens when the type declaration is fully parsed (so usually when the closing curly brace is parsed).</p>
<p>If you create types through the metaobject system directly, you must call <code>.^compose</code> on them before they become fully functional.</p>
<p>Most metaclasses also use composition time to calculate some properties like the method resolution order, publish a method cache, and other house-keeping tasks. Meddling with types after they have been composed is sometimes possible, but usually a recipe for disaster. Don&#39;t do it.</p>
<h2 id="Power_and_responsibility"><a class="u" href="mop.html#___top" title="go to top of document">Power and responsibility</a></h2>
<p>The metaobject protocol offers much power that regular Raku code intentionally limits, such as calling private methods on classes that don&#39;t trust you, peeking into private attributes, and other things that usually simply aren&#39;t done.</p>
<p>Regular Raku code has many safety checks in place; not so the metamodel. It is close to the underlying virtual machine, and violating the contracts with the VM can lead to all sorts of strange behaviors that, in normal code, would obviously be bugs.</p>
<p>So be extra careful and thoughtful when writing metatypes.</p>
<h2 id="Power,_convenience_and_pitfalls"><a class="u" href="mop.html#___top" title="go to top of document">Power, convenience and pitfalls</a></h2>
<p>The metaobject protocol is designed to be powerful enough to implement the Raku object system. This power occasionally comes at the cost of convenience.</p>
<p>For example, when you write <code>my $x = 42</code> and then proceed to call methods on <code>$x</code>, most of these methods end up acting on the <a href="../type/Int.html">integer</a> 42, not on the <a href="../type/Scalar.html">scalar container</a> in which it is stored. This is a piece of convenience found in ordinary Raku. Many parts of the metaobject protocol cannot afford to offer the convenience of automatically ignoring scalar containers, because they are used to implement those scalar containers as well. So if you write <code>my $t = MyType; ... ; $t.^compose</code> you are composing the Scalar that the <code>$</code>-sigiled variable implies, not <code>MyType</code>.</p>
<p>The consequence is that you need to have a rather detailed understanding of the subtleties of Raku in order to avoid pitfalls when working with the MOP, and can&#39;t expect the same <a href="glossary.html#DWIM">&quot;do what I mean&quot;</a> convenience that ordinary Raku code offers.</p>

        </div>
    </div>

    

    <footer class="pretty-box yellow">
        <p style="display:;">
            Generated from <a href="https://github.com/Raku/doc/edit/master/doc//Language/mop.pod6">https://github.com/Raku/doc/edit/master/doc//Language/mop.pod6</a>.
        </p>
        <p>
            This is a work in progress to document Raku (formerly known as Perl 6), and
            known to be incomplete.
        </p>
        <p>
            <a href="https://github.com/Raku/doc/blob/master/CONTRIBUTING.md#reporting-bugs">
                Please report any issues
            </a>
            Your contribution is appreciated.
        </p>
        <p>
            This documentation is provided under the terms of the
            <a href="https://raw.githubusercontent.com/Raku/doc/master/LICENSE">
                Artistic License 2.0
            </a>. The Camelia image is
            <a href="https://raw.githubusercontent.com/Raku/mu/master/misc/camelia.txt">
                copyright © 2009 by Larry Wall.
            </a>
            <!-- CREDITS -->
            <!--External Link Image by Zapyon, CCA-SA 4.0. Derived from Wikimedia Foundation https://commons.wikimedia.org/wiki/File:External-link-04-bold-12x12.svg -->
        </p>
    </footer>

    <script type="text/javascript" src="../js/app.js%3Fv=1"></script>
    <script type="text/javascript" src="../js/search.js%3Fv=3"></script>
</body>
</html>
